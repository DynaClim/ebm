use super::*;
use pretty_assertions::assert_eq;

fn test_universe(system_size: usize) -> Universe {
    let planet = test_planet();
    let mut universe = Universe::new();
    universe.planet = planet;
    universe.initial_temperatures = vec![300.; system_size];
    universe.initialise().unwrap();
    universe
}

fn test_planet() -> Planet {
    let x_vals = vec![
        267.635024549918,
        274.509001636661,
        280.237315875614,
        286.538461538462,
        292.266775777414,
        296.849427168576,
        300.572831423895,
        306.0147299509,
        311.743044189853,
        315.752864157119,
        320.049099836334,
        324.345335515548,
        327.78232405892,
        334.083469721768,
        342.103109656301,
        350.69558101473,
        358.142389525368,
        363.584288052373,
        368.453355155483,
        373.036006546645,
        379.337152209493,
        387.356792144026,
        398.240589198036,
        408.551554828151,
        524.836333878887,
        539.157119476269,
        557.487725040917,
        581.546644844517,
        602.741407528642,
        629.091653027823,
        653.150572831424,
        670.908346972177,
        696.112929623568,
        719.026186579378,
        743.657937806874,
        762.561374795417,
        776.882160392799,
        787.193126022913,
        893.166939443535,
        898.895253682488,
        904.050736497545,
        938.993453355156,
        988.256955810148,
        1055.85106382979,
    ];
    let y_vals = vec![
        218.533171028606,
        233.444917833232,
        246.652465003043,
        261.564211807669,
        275.197808886184,
        285.849056603774,
        293.091905051735,
        298.630553864881,
        304.169202678028,
        308.429701765064,
        312.477175897748,
        308.429701765064,
        304.169202678028,
        294.796104686549,
        281.162507608034,
        264.972611077298,
        249.634814363968,
        238.983566646379,
        231.314668289714,
        226.202069385271,
        220.663420572124,
        216.402921485088,
        212.355447352404,
        208.734023128424,
        208.734023128424,
        208.734023128424,
        208.734023128424,
        208.30797321972,
        208.30797321972,
        207.881923311016,
        207.881923311016,
        207.455873402313,
        207.455873402313,
        207.242848447961,
        207.455873402313,
        207.455873402313,
        207.455873402313,
        207.455873402313,
        242.391965916007,
        250.912964090079,
        258.581862446744,
        293.517954960438,
        406.42118076689,
        559.799147900183,
    ];

    let mut interpolator = Interpolator::<f64>::new();
    interpolator.init(&x_vals, &y_vals);
    Planet {
        // will be computed during initialisation
        heat_capacity_reciprocal: 0.0,

        albedo_low_temperature: 0.77,
        albedo_high_temperature: 0.28,
        temperature_centre_transition: 268.0,
        temperature_width_transition: 5.0,
        insolation_factor: 1.0,
        fiducial_diffusion_coefficient: 0.5394,
        eccentricity: Source::Constant(0.0167),
        obliquity: Source::Constant(23.44),
        outgoing_longwave_radiation: interpolator,
        orbital_period: 365.0,
        land_fraction: 0.3,
        water_fraction: 0.7,
        ..Default::default()
    }
}

#[test]
fn test_derive() {
    let system_size = 145;
    let mut universe = test_universe(system_size);
    let temperatures = vec![300.0; system_size];
    let expected = vec![
        -1.0929212030241933e-6,
        -1.0930729629707319e-6,
        -1.093528170580833e-6,
        -1.0942866092003278e-6,
        -1.0953479178535102e-6,
        -1.0887078913570256e-6,
        -1.0637267447247274e-6,
        -1.0323334581735836e-6,
        -9.977062561077475e-7,
        -9.612271575049824e-7,
        -9.236395121306995e-7,
        -8.85391559161295e-7,
        -8.467755362617017e-7,
        -8.079936614291369e-7,
        -7.691927940993816e-7,
        -7.304840310426266e-7,
        -6.91954426511948e-7,
        -6.536743241100115e-7,
        -6.157021158883917e-7,
        -5.780874285992335e-7,
        -5.408733139425658e-7,
        -5.040977888118208e-7,
        -4.677949401179382e-7,
        -4.319957311781519e-7,
        -3.96728599371693e-7,
        -3.620199051403778e-7,
        -3.278942733895788e-7,
        -2.943748558586123e-7,
        -2.6148353466945846e-7,
        -2.2924108156409897e-7,
        -1.976672833923414e-7,
        -1.6678104163504292e-7,
        -1.366004517676334e-7,
        -1.0714286683905519e-7,
        -7.842494859655515e-8,
        -5.0462708715202896e-8,
        -2.3271542115226654e-8,
        3.133746083372893e-9,
        2.873891874907617e-8,
        5.353028910265762e-8,
        7.749470648432436e-8,
        1.0061954490370564e-7,
        1.2289269387114852e-7,
        1.4430255110256908e-7,
        1.6483801676452594e-7,
        1.844884889856563e-7,
        2.0324386040831198e-7,
        2.2109451559277703e-7,
        2.3803132911772694e-7,
        2.540456642460837e-7,
        2.6912937204634586e-7,
        2.8327479087667125e-7,
        2.9647474615323987e-7,
        3.0872255033625393e-7,
        3.200120030768028e-7,
        3.3033739147609603e-7,
        3.3969349041552673e-7,
        3.480755629219179e-7,
        3.5547936053729053e-7,
        3.619011236667556e-7,
        3.6733758188177926e-7,
        3.717859541591939e-7,
        3.7524394903906177e-7,
        3.7770976468682943e-7,
        3.7918208884728615e-7,
        3.7966009867963953e-7,
        3.7914346046464146e-7,
        3.776323291760973e-7,
        3.7512734791040516e-7,
        3.7162964716891265e-7,
        3.671408439889702e-7,
        3.6166304092052236e-7,
        3.5519882484602633e-7,
        3.477512656423574e-7,
        3.3932391468421353e-7,
        3.2992080318935303e-7,
        3.195464404068335e-7,
        3.082058116502339e-7,
        2.9590437617870065e-7,
        2.826480649295277e-7,
        2.684432781069144e-7,
        2.532968826325165e-7,
        2.3721620946448594e-7,
        2.2020905079283574e-7,
        2.022836571202642e-7,
        1.8344873423897876e-7,
        1.637134401156705e-7,
        1.4308738169856863e-7,
        1.2158061166258755e-7,
        9.920362511089927e-8,
        7.596735625397604e-8,
        5.188317509027091e-8,
        2.6962884116343642e-8,
        1.2187150984778917e-9,
        -2.533667405717984e-8,
        -5.269020229305691e-8,
        -8.08283681973139e-8,
        -1.097372525516257e-7,
        -1.3940252056160466e-7,
        -1.698094236900977e-7,
        -2.0094280099934272e-7,
        -2.3278707989078114e-7,
        -2.653262761104364e-7,
        -2.9854399286227144e-7,
        -3.324234188406924e-7,
        -3.6694732495483607e-7,
        -4.020980594695939e-7,
        -4.3785754122889356e-7,
        -4.742072505523375e-7,
        -5.111282173025377e-7,
        -5.486010055015864e-7,
        -5.866056937233456e-7,
        -6.251218502932062e-7,
        -6.641285020744297e-7,
        -7.036040952906211e-7,
        -7.435264464002536e-7,
        -7.838726804634282e-7,
        -8.246191536695003e-7,
        -8.657413556495617e-7,
        -9.072137857679996e-7,
        -9.490097956073775e-7,
        -9.911013870839395e-7,
        -1.0334589516826783e-6,
        -1.0760509306022688e-6,
        -1.1188433672401074e-6,
        -1.161799310961252e-6,
        -1.2048780120726125e-6,
        -1.24803381829951e-6,
        -1.2912146357778927e-6,
        -1.3343597399812305e-6,
        -1.3773965905789886e-6,
        -1.4202360733828293e-6,
        -1.462765169460328e-6,
        -1.504835235901339e-6,
        -1.5462424107709895e-6,
        -1.5866929527858255e-6,
        -1.625737260185704e-6,
        -1.6626307623047571e-6,
        -1.695990361529139e-6,
        -1.7226368975963594e-6,
        -1.7306405976542751e-6,
        -1.7306405976542751e-6,
        -1.7306405976542751e-6,
        -1.7306405976542751e-6,
        -1.7306405976542751e-6,
    ];
    let mut result = vec![0.0; system_size];
    let time = 1234567.;
    universe.derive(time, &temperatures, &mut result).unwrap();
    assert_eq!(expected, result);
}

#[test]
fn test_insolation() {
    panic!();
}
/*
#[test]
fn test_energy_transport() {
    let system_size = 5;
    let temperatures = vec![300.; system_size];
    let mut universe = test_universe(system_size);
    energy_transport(&temperatures);
    let expected = vec![1., 2., 3., 4., 5.];
    assert_eq!(expected, universe.transport);
}
*/
#[test]
fn test_d2t_dx2() {
    let system_size = 5;
    let temperatures = vec![300.; system_size];
    let mut universe = test_universe(system_size);

    // first and second derivatives
    let expected_1 = vec![1., 2., 3., 4., 5.];
    let expected_2 = vec![1., 2., 3., 4., 5.];
    universe.d2t_dx2(&temperatures);
    assert_eq!(expected_1, universe.dx);
    assert_eq!(expected_2, universe.dx2);
}

#[test]
fn test_sinusoidal_excitation() {
    panic!();
}

#[test]
fn test_damping() {
    panic!();
}

#[test]
fn test_albedo() {
    panic!();
}

#[test]
fn test_eccentricity() {
    panic!();
}

#[test]
fn test_obliquity() {
    panic!();
}

#[test]
fn test_declination() {
    panic!();
}

#[test]
fn test_stellar_longitude() {
    panic!();
}

// Planet tests
/*
#[test]
fn test_merged_ir_cooling() {
    let system_size = 5;
    let temperatures = vec![300.; system_size];
    let planet = test_planet();
    let mut result = vec![0.0; system_size];
    planet.merged_ir_cooling(&temperatures, &mut result).unwrap();

    let expected = vec![1., 2., 3., 4., 5.];
    assert_eq!(expected, result);
}
#[test]
fn test_heat_capacity() {
    let system_size = 5;
    let temperatures = vec![300.; system_size];
    let planet = test_planet();
    let mut result = vec![0.0; system_size];
    planet.heat_capacity(&temperatures, &mut result).unwrap();

    let expected = vec![1., 2., 3., 4., 5.];
    assert_eq!(expected, result);
}
*/
